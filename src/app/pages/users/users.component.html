<div class="flex align-items-center justify-content-center min-h-screen mx-5">
    <div class="surface-card p-4 shadow-2 border-round w-full">
        <div class="flex flex-row justify-content-between align-content-center">
            <h3>Users</h3>
            <p-button icon="pi pi-plus" label="Create" [routerLink]="'new'" />
        </div>
        <div class="card">
            <p-toast></p-toast>
            <pre>{{ userForm.value | json }}</pre>
            <p-table [value]="users" dataKey="id" editMode="row" [paginator]="users.length > 10" [rows]="10"
                [globalFilterFields]="['avatar', 'userName', 'roleName', 'email', 'phoneNumber']">
                <ng-template pTemplate="header">
                    <tr>
                        <th class="text-center">Avatar</th>
                        <th [ngStyle]="{ 'min-width': '16rem' }">Name</th>
                        <th [ngStyle]="{ 'min-width': '16rem' }">Role</th>
                        <th [ngStyle]="{ 'min-width': '16rem' }">Email</th>
                        <th [ngStyle]="{ 'min-width': '16rem' }">Phone</th>
                        <th class="text-center">Actions</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th><p-columnFilter type="text" field="userName" /></th>
                        <th><p-columnFilter type="text" field="roleName" /></th>
                        <th><p-columnFilter type="text" field="email" /></th>
                        <th><p-columnFilter type="text" field="phoneNumber" /></th>
                        <th></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-user let-editing="editing" let-ri="rowIndex">
                    <tr [pEditableRow]="user" [formGroup]="userForm" (ngSubmit)="onSubmit()">
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <div class="avatar-container" (mouseover)="isHovered = true"
                                        (mouseout)="isHovered = false">
                                        <p-avatar [image]="generateImage(user.fileContent, user.fileExtension)"
                                            shape="circle" class="flex justify-content-center" title="Edit Avatar"
                                            role="button" (click)="onAvatarClick()"
                                            [ngStyle]="{'cursor': 'pointer','filter': isHovered ? 'brightness(0.9)' : 'none'}"></p-avatar>
                                        <p-badge
                                            [ngStyle]="{ 'position': 'absolute', 'bottom': '0', 'right': '0', 'transform': 'translate(50%, 50%)' }"
                                            value="" styleClass="badge-icon">
                                            <i class="pi pi-pencil"></i>
                                        </p-badge>
                                        <input type="file" #fileInput (change)="onFileSelected($event)"
                                            [ngStyle]="{'display': 'none'}" title="File Input" />
                                    </div>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    <p-avatar [image]='generateImage(user.fileContent, user.fileExtension)'
                                        shape="circle" class="flex justify-content-center" />
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input title="Name" pInputText type="text" class="p-inputtext w-full" required
                                        [(ngModel)]="user.userName" formControlName="userName" />
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{user.userName}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="roles" appendTo="body" [(ngModel)]="user.roleName"
                                        formControlName="roleName" />
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{user.roleName}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input title="Email" pInputText type="email" class="p-inputtext w-full" required
                                        [(ngModel)]="user.email" formControlName="email" />
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{user.email}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input title="Phone" pInputText type="tel" class="p-inputtext w-full"
                                        [(ngModel)]="user.phoneNumber" formControlName="phoneNumber" />
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{user.phoneNumber}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <div class="flex align-items-center justify-content-center gap-2">
                                <button title="Edit Init" *ngIf="!editing" pButton pRipple type="button"
                                    pInitEditableRow icon="pi pi-pencil" (click)="onRowEditInit(user)"
                                    class="p-button-rounded p-button-text" [disabled]="isEditingUser">
                                </button>
                                <button title="Edit Save" *ngIf="editing" pButton pRipple type="button" pSaveEditableRow
                                    icon="pi pi-check" (click)="onRowEditSave(user)"
                                    class="p-button-rounded p-button-text p-button-success mr-2">
                                </button>
                                <button title="Edit Cancel" *ngIf="editing" pButton pRipple type="button"
                                    pCancelEditableRow icon="pi pi-times" (click)="onRowEditCancel(user, ri)"
                                    class="p-button-rounded p-button-text p-button-danger">
                                </button>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>